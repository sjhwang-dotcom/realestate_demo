<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lumina AI - Agentic Real Estate Intelligence</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --bgMain: #f8fafc;
            --bgPanel: #ffffff;
            --bgSoft: #f1f5f9;
            --textMain: #1e293b;
            --textMuted: #64748b;
            --borderSubtle: #e2e8f0;
            --accentBlue: #3b82f6;
        }

        body {
            background: var(--bgMain);
            color: var(--textMain);
        }

        .conversation-item {
            padding: 12px;
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.15s;
        }

        .conversation-item:hover {
            background: var(--bgSoft);
        }

        .conversation-item.active {
            background: #eff6ff;
            border-left: 3px solid var(--accentBlue);
        }

        .message-bubble {
            max-width: 80%;
            padding: 12px 16px;
            border-radius: 12px;
            margin-bottom: 12px;
        }

        .message-user {
            background: var(--accentBlue);
            color: white;
            margin-left: auto;
            border-bottom-right-radius: 4px;
        }

        .message-assistant {
            background: var(--bgSoft);
            color: var(--textMain);
            border-bottom-left-radius: 4px;
        }

        .report-item {
            padding: 12px;
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.15s;
            border: 1px solid var(--borderSubtle);
        }

        .report-item:hover {
            background: var(--bgSoft);
            border-color: var(--accentBlue);
        }

        .report-item.active {
            background: #eff6ff;
            border-color: var(--accentBlue);
        }

        .markdown-content h1 {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 1rem;
        }

        .markdown-content h2 {
            font-size: 1.25rem;
            font-weight: 600;
            margin-top: 1.5rem;
            margin-bottom: 0.75rem;
        }

        .markdown-content p {
            margin-bottom: 0.75rem;
        }

        .markdown-content ul {
            list-style: disc;
            padding-left: 1.5rem;
            margin-bottom: 0.75rem;
        }

        .markdown-content table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
        }

        .markdown-content th,
        .markdown-content td {
            border: 1px solid var(--borderSubtle);
            padding: 8px 12px;
            text-align: left;
        }

        .markdown-content th {
            background: var(--bgSoft);
            font-weight: 600;
        }
    </style>
</head>

<body class="overflow-hidden font-sans text-sm antialiased">
    <div class="flex h-screen w-full overflow-hidden">
        <!-- NAV RAIL -->
        <aside class="w-14 bg-slate-900 flex flex-col items-center py-4 shrink-0">
            <img src="logo.png" alt="DeepAuto" class="w-9 h-9 rounded-lg object-contain mb-6"
                style="filter: invert(1) brightness(2);" />
            <a href="index.html"
                class="w-9 h-9 flex items-center justify-center rounded-lg text-white/60 hover:text-white hover:bg-white/10 mb-2"
                title="Dashboard">
                <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M4 5a1 1 0 011-1h14a1 1 0 011 1v2a1 1 0 01-1 1H5a1 1 0 01-1-1V5zM4 13a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H5a1 1 0 01-1-1v-6zM16 13a1 1 0 011-1h2a1 1 0 011 1v6a1 1 0 01-1 1h-2a1 1 0 01-1-1v-6z" />
                </svg>
            </a>
            <a href="lumina.html"
                class="w-9 h-9 flex items-center justify-center rounded-lg bg-white/10 text-white mb-2"
                title="Lumina AI">
                <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />
                </svg>
            </a>
            <a href="lakehouse.html"
                class="w-9 h-9 flex items-center justify-center rounded-lg text-white/60 hover:text-white hover:bg-white/10 mb-2"
                title="Data Lakehouse">
                <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M4 7v10c0 2.21 3.582 4 8 4s8-1.79 8-4V7M4 7c0 2.21 3.582 4 8 4s8-1.79 8-4M4 7c0-2.21 3.582-4 8-4s8 1.79 8 4m0 5c0 2.21-3.582 4-8 4s-8-1.79-8-4" />
                </svg>
            </a>
            <a href="tools.html"
                class="w-9 h-9 flex items-center justify-center rounded-lg text-white/60 hover:text-white hover:bg-white/10 mb-2"
                title="Tool Studio">
                <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z" />
                </svg>
            </a>
            <div class="flex-1"></div>
        </aside>

        <!-- MAIN -->
        <div class="flex-1 flex flex-col min-w-0 h-full">
            <!-- HEADER -->
            <header class="h-12 border-b border-borderSubtle bg-bgPanel flex items-center justify-between px-4 shrink-0"
                style="border-color: var(--borderSubtle); background: var(--bgPanel);">
                <div class="flex items-center gap-4 cursor-pointer" onclick="showWelcome()">
                    <div class="flex items-center gap-2">
                        <svg class="h-5 w-5 text-slate-700" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />
                        </svg>
                        <h1 class="font-semibold text-base" style="color: var(--textMain);">Lumina AI</h1>
                    </div>
                    <span class="text-xs" style="color: var(--textMuted);">AI-powered insights and analysis</span>
                </div>
            </header>

            <!-- BODY -->
            <div class="flex flex-1 overflow-hidden">
                <!-- LEFT SIDEBAR -->
                <aside class="w-72 h-full border-r flex flex-col shrink-0"
                    style="background: var(--bgPanel); border-color: var(--borderSubtle);">
                    <!-- New Chat + Search -->
                    <div class="p-3 border-b" style="border-color: var(--borderSubtle);">
                        <button onclick="startNewChat()"
                            class="w-full flex items-center gap-2 px-3 py-2 mb-2 text-sm font-medium rounded-lg bg-slate-800 text-white hover:bg-slate-900 transition-colors">
                            <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M12 4v16m8-8H4" />
                            </svg>
                            New Chat
                        </button>
                        <div class="relative">
                            <svg class="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4"
                                style="color: var(--textMuted);" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                            </svg>
                            <input type="text" placeholder="Search conversations..."
                                class="w-full pl-9 pr-3 py-2 text-sm rounded-lg border outline-none focus:border-blue-500"
                                style="background: var(--bgSoft); border-color: var(--borderSubtle); color: var(--textMain);">
                        </div>
                    </div>

                    <!-- Conversations -->
                    <div class="flex-1 overflow-y-auto">
                        <div class="p-2">
                            <h3 class="text-xs font-semibold uppercase tracking-wider px-2 py-2"
                                style="color: var(--textMuted);">Conversations</h3>
                            <div id="conversationList" class="space-y-1">
                                <!-- Conversations loaded here -->
                            </div>
                        </div>

                        <div class="p-2 border-t" style="border-color: var(--borderSubtle);">
                            <h3 class="text-xs font-semibold uppercase tracking-wider px-2 py-2"
                                style="color: var(--textMuted);">Generated Reports</h3>
                            <div id="reportList" class="space-y-2">
                                <!-- Reports loaded here -->
                            </div>
                        </div>
                    </div>
                </aside>

                <!-- MAIN CONTENT -->
                <main class="flex-1 flex flex-col overflow-hidden" style="background: var(--bgMain);">
                    <div id="mainContent" class="flex-1 overflow-y-auto p-6">
                        <!-- Default Welcome Screen with Example Cards -->
                        <div id="welcomeScreen" class="max-w-4xl mx-auto">
                            <div class="text-center mb-8">
                                <div
                                    class="w-16 h-16 rounded-full bg-gradient-to-br from-slate-100 to-slate-200 flex items-center justify-center mx-auto mb-4">
                                    <svg class="w-8 h-8 text-slate-600" fill="none" viewBox="0 0 24 24"
                                        stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />
                                    </svg>
                                </div>
                                <h2 class="text-xl font-semibold mb-2" style="color: var(--textMain);">How can I help
                                    you today?</h2>
                                <p class="text-sm" style="color: var(--textMuted);">Ask me anything about your
                                    portfolio, or try one of these examples</p>
                            </div>

                            <!-- Example Prompt Cards -->
                            <div class="grid grid-cols-2 gap-4 mb-8">
                                <div class="example-card bg-white rounded-xl border p-4 cursor-pointer hover:border-blue-400 hover:shadow-md transition-all"
                                    style="border-color: var(--borderSubtle);"
                                    onclick="usePrompt('Give me a comprehensive analysis of our portfolio performance for Q4 2024')">
                                    <div class="flex items-start gap-3">
                                        <div
                                            class="w-10 h-10 rounded-lg bg-blue-50 flex items-center justify-center text-blue-600 flex-shrink-0">
                                            <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                    d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                                            </svg>
                                        </div>
                                        <div>
                                            <div class="font-medium text-sm mb-1" style="color: var(--textMain);">
                                                Portfolio Performance Analysis</div>
                                            <div class="text-xs" style="color: var(--textMuted);">Comprehensive Q4 2024
                                                metrics across all properties and regions</div>
                                        </div>
                                    </div>
                                </div>

                                <div class="example-card bg-white rounded-xl border p-4 cursor-pointer hover:border-green-400 hover:shadow-md transition-all"
                                    style="border-color: var(--borderSubtle);"
                                    onclick="usePrompt('What properties should we target for Fund III? We have $250M to deploy.')">
                                    <div class="flex items-start gap-3">
                                        <div
                                            class="w-10 h-10 rounded-lg bg-green-50 flex items-center justify-center text-green-600 flex-shrink-0">
                                            <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                    d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                            </svg>
                                        </div>
                                        <div>
                                            <div class="font-medium text-sm mb-1" style="color: var(--textMain);">Fund
                                                III Acquisition Strategy</div>
                                            <div class="text-xs" style="color: var(--textMuted);">Investment
                                                recommendations based on $250M deployment target</div>
                                        </div>
                                    </div>
                                </div>

                                <div class="example-card bg-white rounded-xl border p-4 cursor-pointer hover:border-purple-400 hover:shadow-md transition-all"
                                    style="border-color: var(--borderSubtle);"
                                    onclick="usePrompt('Show me our delinquency situation across the portfolio')">
                                    <div class="flex items-start gap-3">
                                        <div
                                            class="w-10 h-10 rounded-lg bg-purple-50 flex items-center justify-center text-purple-600 flex-shrink-0">
                                            <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                    d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                            </svg>
                                        </div>
                                        <div>
                                            <div class="font-medium text-sm mb-1" style="color: var(--textMain);">
                                                Delinquency & Collections</div>
                                            <div class="text-xs" style="color: var(--textMuted);">Portfolio-wide aging
                                                analysis and collection strategies</div>
                                        </div>
                                    </div>
                                </div>

                                <div class="example-card bg-white rounded-xl border p-4 cursor-pointer hover:border-orange-400 hover:shadow-md transition-all"
                                    style="border-color: var(--borderSubtle);"
                                    onclick="usePrompt('Our insurance costs are killing us. What can we do?')">
                                    <div class="flex items-start gap-3">
                                        <div
                                            class="w-10 h-10 rounded-lg bg-orange-50 flex items-center justify-center text-orange-600 flex-shrink-0">
                                            <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                    d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />
                                            </svg>
                                        </div>
                                        <div>
                                            <div class="font-medium text-sm mb-1" style="color: var(--textMain);">
                                                Insurance Cost Analysis</div>
                                            <div class="text-xs" style="color: var(--textMuted);">Review renewal
                                                strategy and savings opportunities</div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Recent Conversations Preview -->
                            <div class="border-t pt-6" style="border-color: var(--borderSubtle);">
                                <h3 class="text-sm font-medium mb-4" style="color: var(--textMuted);">Recent
                                    Conversations</h3>
                                <div id="recentConversations" class="grid grid-cols-3 gap-3">
                                    <!-- Filled by JS -->
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Chat Input -->
                    <div class="p-4 border-t" style="border-color: var(--borderSubtle); background: var(--bgPanel);">
                        <div class="flex gap-3">
                            <input type="text" id="chatInput" placeholder="Ask Lumina anything about your portfolio..."
                                class="flex-1 px-4 py-3 text-sm rounded-lg border outline-none focus:border-blue-500"
                                style="background: var(--bgSoft); border-color: var(--borderSubtle); color: var(--textMain);"
                                onkeypress="if(event.key==='Enter') sendMessage()">
                            <button onclick="sendMessage()"
                                class="px-4 py-3 rounded-lg bg-slate-800 text-white hover:bg-slate-900 transition-colors">
                                <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8" />
                                </svg>
                            </button>
                        </div>
                    </div>
                </main>
            </div>
        </div>
    </div>

    <script>
        let luminaData = { conversations: [], reports: [] };
        let currentView = null;

        // Load data
        async function loadData() {
            try {
                const response = await fetch('data/lumina.json');
                luminaData = await response.json();
                renderConversations();
                renderReports();
                renderRecentConversations();
            } catch (error) {
                console.error('Error loading Lumina data:', error);
            }
        }

        function renderConversations() {
            const container = document.getElementById('conversationList');
            container.innerHTML = luminaData.conversations.map((conv, idx) => `
                <div class="conversation-item" onclick="loadConversation(${idx})" id="conv-${idx}">
                    <div class="font-medium text-sm" style="color: var(--textMain);">${conv.title}</div>
                    <div class="text-xs truncate mt-0.5" style="color: var(--textMuted);">${conv.preview}</div>
                    <div class="text-xs mt-1" style="color: var(--textMuted);">${conv.date}</div>
                </div>
            `).join('');
        }

        function renderReports() {
            const container = document.getElementById('reportList');
            container.innerHTML = luminaData.reports.map((report, idx) => `
                <div class="conversation-item" onclick="loadReport(${idx})" id="report-${idx}">
                    <div class="font-medium text-sm" style="color: var(--textMain);">${report.title}</div>
                    <div class="text-xs truncate mt-0.5" style="color: var(--textMuted);">${report.type === 'financial' ? 'Financial Report' : report.type === 'investor' ? 'Investor Communication' : 'Due Diligence'}</div>
                    <div class="text-xs mt-1" style="color: var(--textMuted);">${report.date}</div>
                </div>
            `).join('');
        }

        function parseMarkdown(text) {
            // First, handle special patterns
            let html = text
                // Bold with colon
                .replace(/\*\*([^*]+):\*\*/g, '<strong class="block mt-3 text-slate-800">$1:</strong>')
                // Regular bold
                .replace(/\*\*([^*]+)\*\*/g, '<strong>$1</strong>');

            // Handle tables
            const lines = html.split('\n');
            let inTable = false;
            let tableHtml = '';
            let result = [];

            lines.forEach(line => {
                if (line.includes('|') && !line.includes('---')) {
                    if (!inTable) {
                        inTable = true;
                        tableHtml = '<table class="w-full border-collapse my-3 text-xs bg-white rounded overflow-hidden">';
                    }
                    const cells = line.split('|').filter(c => c.trim());
                    const isFirst = tableHtml.split('<tr>').length <= 2;
                    const tag = isFirst ? 'th' : 'td';
                    const bgClass = isFirst ? 'bg-slate-100 font-semibold' : '';
                    tableHtml += `< tr > ${cells.map(c => `<${tag} class="px-3 py-2 border border-slate-200 text-left ${bgClass}">${c.trim()}</${tag}>`).join('')}</tr > `;
                } else if (line.includes('---') && line.includes('|')) {
                    // Skip separator row
                } else {
                    if (inTable) {
                        inTable = false;
                        result.push(tableHtml + '</table>');
                        tableHtml = '';
                    }
                    // Handle numbered lists with bold
                    if (/^\d+\.\s*\*\*/.test(line)) {
                        line = line.replace(/^(\d+)\.\s*(.*)/, '<div class="font-semibold mt-3 text-slate-800">$1. $2</div>');
                    }
                    // Handle bullet points (- or ‚Ä¢)
                    else if (/^[-‚Ä¢]\s/.test(line.trim())) {
                        line = line.replace(/^[-‚Ä¢]\s*(.*)/, '<div class="ml-4 flex gap-2"><span class="text-slate-400">‚Ä¢</span><span>$1</span></div>');
                    }
                    // Handle indented bullet points
                    else if (/^\s+[-‚Ä¢]\s/.test(line)) {
                        line = line.replace(/^\s+[-‚Ä¢]\s*(.*)/, '<div class="ml-8 flex gap-2"><span class="text-slate-400">‚Äì</span><span>$1</span></div>');
                    }
                    result.push(line);
                }
            });

            if (inTable) {
                result.push(tableHtml + '</table>');
            }

            return result.join('<br>');
        }

        function loadConversation(idx) {
            // Update active state
            document.querySelectorAll('.conversation-item').forEach(el => el.classList.remove('active'));
            document.getElementById(`conv-${idx}`).classList.add('active');

            const conv = luminaData.conversations[idx];
            const container = document.getElementById('mainContent');

            let html = `<div class="max-w-4xl mx-auto">
                <h2 class="text-lg font-semibold mb-6" style="color: var(--textMain);">${conv.title}</h2>
                <div class="space-y-4">`;

            conv.messages.forEach((msg, msgIdx) => {
                if (msg.role === 'user') {
                    html += `<div class="message-bubble message-user">
                        <div class="text-sm">${msg.content}</div>
                    </div>`;
                } else {
                    const parsedContent = parseMarkdown(msg.content);
                    html += `<div class="message-bubble message-assistant markdown-content">
                        <div class="text-sm">${parsedContent}</div>
                        ${msg.chart ? `<div class="mt-4 bg-white rounded-lg p-4 border border-slate-200"><canvas id="chart-${idx}-${msgIdx}" height="200"></canvas></div>` : ''}
                    </div>`;
                }
            });

            html += `</div></div>`;
            container.innerHTML = html;

            // Render charts if any
            conv.messages.forEach((msg, msgIdx) => {
                if (msg.chart) {
                    renderConversationChart(`chart-${idx}-${msgIdx}`, msg.chart);
                }
            });

            currentView = { type: 'conversation', idx };
        }

        function renderConversationChart(canvasId, chartConfig) {
            const ctx = document.getElementById(canvasId);
            if (!ctx) return;
            new Chart(ctx, chartConfig);
        }

        function loadReport(idx) {
            // Update active state
            document.querySelectorAll('.conversation-item, .report-item').forEach(el => el.classList.remove('active'));
            document.getElementById(`report-${idx}`).classList.add('active');

            const report = luminaData.reports[idx];
            const container = document.getElementById('mainContent');

            // Simple markdown to HTML
            let html = report.content
                .replace(/^# (.+)$/gm, '<h1>$1</h1>')
                .replace(/^## (.+)$/gm, '<h2>$1</h2>')
                .replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>')
                .replace(/\n- (.+)/g, '\n<li>$1</li>')
                .replace(/(<li>.*<\/li>)/gs, '<ul>$1</ul>')
                .replace(/\|(.+)\|/g, (match) => {
                    const cells = match.split('|').filter(c => c.trim());
                    if (cells.some(c => c.includes('---'))) return '';
                    const tag = cells.length && !match.includes('---') ? 'td' : 'th';
                    return `<tr>${cells.map(c => `<${tag}>${c.trim()}</${tag}>`).join('')}</tr>`;
                })
                .replace(/(<tr>.*<\/tr>)/gs, '<table>$1</table>')
                .replace(/\n\n/g, '</p><p>')
                .replace(/^(.+)$/gm, '<p>$1</p>');

            container.innerHTML = `
                <div class="max-w-3xl mx-auto markdown-content">
                    <div class="text-xs mb-4" style="color: var(--textMuted);">Generated: ${report.date}</div>
                    ${html}
                </div>
                `;
            currentView = { type: 'report', idx };
        }

        function startNewChat() {
            showWelcome();
            document.getElementById('chatInput').focus();
        }

        function sendMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            if (!message) return;

            if (currentView?.type !== 'new') {
                startNewChat();
            }

            const messagesContainer = document.getElementById('chatMessages');

            // Add user message
            messagesContainer.innerHTML += `
                <div class="message-bubble message-user">
                    <div class="text-sm">${message}</div>
                </div>
                `;

            // Simulate AI response
            setTimeout(() => {
                messagesContainer.innerHTML += `
                <div class="message-bubble message-assistant">
                    <div class="text-sm">I'm analyzing your request about "${message}". In a production environment, this would connect to the Lumina AI backend to provide real-time portfolio insights.</div>
                    </div>
                `;
            }, 500);

            input.value = '';
        }

        function usePrompt(prompt) {
            document.getElementById('chatInput').value = prompt;
            sendMessage();
        }

        function renderRecentConversations() {
            const container = document.getElementById('recentConversations');
            if (!container) return;

            const recent = luminaData.conversations.slice(0, 3);
            container.innerHTML = recent.map((conv, idx) => `
                <div class="bg-white rounded-lg border p-3 cursor-pointer hover:border-slate-400 transition-all" style="border-color: var(--borderSubtle);" onclick="loadConversation(${idx})">
                    <div class="flex items-center gap-2 mb-2">
                        <svg class="w-4 h-4 text-slate-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z" />
                        </svg>
                        <span class="text-xs" style="color: var(--textMuted);">${conv.date}</span>
                    </div>
                    <div class="font-medium text-sm mb-1" style="color: var(--textMain);">${conv.title}</div>
                    <div class="text-xs truncate" style="color: var(--textMuted);">${conv.preview}</div>
                </div>
            `).join('');
        }

        function showWelcome() {
            // Deselect all sidebar items
            document.querySelectorAll('.conversation-item, .report-item').forEach(el => el.classList.remove('active'));

            // Restore welcome screen
            const container = document.getElementById('mainContent');
            container.innerHTML = `
                <div id="welcomeScreen" class="max-w-4xl mx-auto">
                    <div class="text-center mb-8">
                        <div class="w-16 h-16 rounded-full bg-gradient-to-br from-amber-100 to-amber-200 flex items-center justify-center mx-auto mb-4">
                            <svg class="w-8 h-8 text-amber-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />
                            </svg>
                        </div>
                        <h2 class="text-xl font-semibold mb-2" style="color: var(--textMain);">How can I help you today?</h2>
                        <p class="text-sm" style="color: var(--textMuted);">Ask me anything about your portfolio, or try one of these examples</p>
                    </div>

                    <div class="grid grid-cols-2 gap-4 mb-8">
                        <div class="example-card bg-white rounded-xl border p-4 cursor-pointer hover:border-blue-400 hover:shadow-md transition-all" style="border-color: var(--borderSubtle);" onclick="usePrompt('Give me a comprehensive analysis of our portfolio performance for Q4 2024')">
                            <div class="flex items-start gap-3">
                                <div class="w-10 h-10 rounded-lg bg-blue-50 flex items-center justify-center text-blue-600 flex-shrink-0">üìä</div>
                                <div>
                                    <div class="font-medium text-sm mb-1" style="color: var(--textMain);">Portfolio Performance Analysis</div>
                                    <div class="text-xs" style="color: var(--textMuted);">Comprehensive Q4 2024 metrics across all properties and regions</div>
                                </div>
                            </div>
                        </div>
                        <div class="example-card bg-white rounded-xl border p-4 cursor-pointer hover:border-green-400 hover:shadow-md transition-all" style="border-color: var(--borderSubtle);" onclick="usePrompt('What properties should we target for Fund III? We have $250M to deploy.')">
                            <div class="flex items-start gap-3">
                                <div class="w-10 h-10 rounded-lg bg-green-50 flex items-center justify-center text-green-600 flex-shrink-0">üí∞</div>
                                <div>
                                    <div class="font-medium text-sm mb-1" style="color: var(--textMain);">Fund III Acquisition Strategy</div>
                                    <div class="text-xs" style="color: var(--textMuted);">Investment recommendations based on $250M deployment target</div>
                                </div>
                            </div>
                        </div>
                        <div class="example-card bg-white rounded-xl border p-4 cursor-pointer hover:border-purple-400 hover:shadow-md transition-all" style="border-color: var(--borderSubtle);" onclick="usePrompt('Show me our delinquency situation across the portfolio')">
                            <div class="flex items-start gap-3">
                                <div class="w-10 h-10 rounded-lg bg-purple-50 flex items-center justify-center text-purple-600 flex-shrink-0">‚ö†Ô∏è</div>
                                <div>
                                    <div class="font-medium text-sm mb-1" style="color: var(--textMain);">Delinquency & Collections</div>
                                    <div class="text-xs" style="color: var(--textMuted);">Portfolio-wide aging analysis and collection strategies</div>
                                </div>
                            </div>
                        </div>
                        <div class="example-card bg-white rounded-xl border p-4 cursor-pointer hover:border-orange-400 hover:shadow-md transition-all" style="border-color: var(--borderSubtle);" onclick="usePrompt('Our insurance costs are killing us. What can we do?')">
                            <div class="flex items-start gap-3">
                                <div class="w-10 h-10 rounded-lg bg-orange-50 flex items-center justify-center text-orange-600 flex-shrink-0">üõ°Ô∏è</div>
                                <div>
                                    <div class="font-medium text-sm mb-1" style="color: var(--textMain);">Insurance Cost Analysis</div>
                                    <div class="text-xs" style="color: var(--textMuted);">Review renewal strategy and savings opportunities</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="border-t pt-6" style="border-color: var(--borderSubtle);">
                        <h3 class="text-sm font-medium mb-4" style="color: var(--textMuted);">Recent Conversations</h3>
                        <div id="recentConversations" class="grid grid-cols-3 gap-3"></div>
                    </div>
                </div>
            `;
            renderRecentConversations();
            currentView = null;
        }

        // Init
        document.addEventListener('DOMContentLoaded', loadData);
    </script>
</body>

</html>